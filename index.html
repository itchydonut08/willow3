<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Willow ‚Äî Notes & Forecasts</title>
<style>
html{scroll-behavior:smooth}
:root { 
  --ink:#0f172a; --muted:#64748b; --line:#e2e8f0; --accent:#4f46e5; 
  --bg:#f8fafc; --accent-soft:#eef2ff; --danger:#ef4444; --ok:#16a34a; 
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--ink);background:var(--bg)}
header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);z-index:10}
nav{max-width:1200px;margin:auto;padding:12px 16px;display:flex;align-items:center;justify-content:space-between}
.chips{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.chip{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--line);border-radius:999px;background:#fff;color:var(--ink);text-decoration:none;cursor:pointer;box-shadow:0 1px 0 rgba(0,0,0,.02);transition:transform .12s ease, box-shadow .12s ease, border-color .12s ease}
.chip:hover{transform:translateY(-1px);box-shadow:0 6px 14px rgba(2,6,23,.06);border-color:#d0d7e2}
.chip:active{transform:translateY(0)}
.chip.active{background:var(--accent);border-color:var(--accent);color:#fff}
.chip.badge{padding:6px 10px;border-color:#cfd8e3;color:#64748b;cursor:default}
.chip.accent{background:var(--accent);border-color:var(--accent);color:#fff}
main{max-width:1200px;margin:auto;padding:20px 16px 80px}
h1,h2{margin:0} h2{font-size:20px;margin-top:24px}
.grid{display:grid;gap:16px}
.grid-cols-2{grid-template-columns:1fr}
.grid-cols-3{grid-template-columns:1fr 2fr 1fr}
@media(min-width:900px){.grid-cols-2{grid-template-columns:1fr 1fr}}
@media(min-width:1200px){.grid-cols-3{grid-template-columns:1fr 2fr 1fr}}
.card{background:#fff;border:1px solid var(--line);border-radius:12px;padding:16px}
label span{font-size:12px;color:var(--muted);display:block}
input,textarea,button{font:inherit}
input,textarea{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:10px;margin-top:6px;background:#fff}
textarea{resize:vertical;min-height:120px}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.btn{border:1px solid var(--line);background:#fff;padding:10px 14px;border-radius:10px;cursor:pointer}
.btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
.btn.danger{border-color:var(--danger);color:#ef4444}
.btn:disabled{opacity:0.6;cursor:not-allowed}
.muted{color:var(--muted);font-size:12px}
.list{margin:8px 0 0;padding:0 0 0 18px}
.pill{font-size:12px;padding:2px 8px;border:1px solid var(--line);border-radius:999px;color:var(--muted);display:inline-block}
.ok{color:var(--ok)} .err{color:var(--danger)}

/* Tab styling */
.tab-content{display:none}
.tab-content.active{display:block}

/* Forecast specific styling */
.forecast-row{display:flex;gap:8px;align-items:center;padding:12px 0;border-bottom:1px solid var(--line)}
.forecast-row:last-child{border-bottom:none}
.forecast-source{background:#243153;color:#c8d4f1;padding:4px 8px;border-radius:999px;font-size:11px;font-weight:500}
.forecast-title{flex:1;font-weight:500}
.forecast-meta{white-space:nowrap;color:var(--muted);font-size:13px}
.forecast-link{color:var(--accent);text-decoration:none;font-size:13px}
.forecast-link:hover{text-decoration:underline}

/* Vote controls */
.vote-box{display:flex;gap:8px;align-items:center;margin-top:8px;padding:8px;background:#f8fafc;border-radius:8px}
.vote-slider{flex:1;min-width:100px}
.vote-output{min-width:42px;text-align:center;font-size:13px;font-weight:500}
.vote-btn{padding:6px 12px;font-size:13px}

/* Hide create/resolve buttons */
[data-action="new-forecast"],
[data-action="resolve-forecast"],
.forecast-create-form,
.forecast-resolve-form,
.btn-new-forecast,
.btn-resolve {
  display: none !important;
}

.linkbtn{background:none;border:none;padding:0;margin:0;cursor:pointer;color:inherit;text-align:left}
svg text{font:12px ui-sans-serif,system-ui;fill:#334155}
</style>
</head>
<body>
<header>
<nav>
<div class="chips">
<div style="font-size:22px;">üåø</div>
<strong>Willow</strong>
</div>
<div class="chips" id="navRight">
<a class="chip active" href="#" onclick="showTab('notecard')">üìù Notecard</a>
<a class="chip" href="#" onclick="showTab('library')">üìö Library</a>
<a class="chip" href="#" onclick="showTab('graph')">üìà Graph</a>
<a class="chip" href="#" onclick="showTab('forecasts')">üéØ Forecasts</a>
<button id="newNoteBtn" class="chip accent">üÜï New Note</button>
</div>
</nav>
</header>

<main>
<!-- Notecard Tab -->
<section id="notecard" class="tab-content active">
<h2>Notecard</h2>
<div class="grid grid-cols-3" style="margin-top:12px;">
<!-- Left: Notes List -->
<div class="card">
<div class="row" style="justify-content:space-between;">
<strong>Recent Notes</strong>
<button id="clearAll" class="btn danger">Clear All</button>
</div>
<ul id="notesList" class="list">
<li><button class="linkbtn">Demo Note 1 - Market Analysis</button></li>
<li><button class="linkbtn">Demo Note 2 - Fed Policy</button></li>
<li><button class="linkbtn">Demo Note 3 - Tech Trends</button></li>
</ul>
</div>

<!-- Center: Editor -->
<div class="card">
<form id="noteForm">
<label><span>Title</span><input name="title" placeholder="Your note title" required></label>
<label style="margin-top:10px;">
<span>Content</span><textarea name="content" placeholder="One idea, in your own words‚Ä¶" required></textarea>
</label>
<label style="margin-top:10px;"><span>Tags (comma-separated)</span><input name="tags" placeholder="banking, liquidity, funding"></label>
<label style="margin-top:10px;"><span>Source (optional)</span><input name="source" placeholder="link or reference"></label>
<div class="row" style="margin-top:12px;">
<button type="button" id="saveDraft" class="btn">Save Draft</button>
<button type="submit" class="btn primary">Publish</button>
<span id="saveMsg" class="muted"></span>
</div>
</form>
</div>

<!-- Right: Suggested Links -->
<div class="card">
<strong>Suggested Links</strong>
<div style="margin-top:10px;">
<button class="btn" onclick="runSuggestions()">Run</button>
<div id="suggestions" style="margin-top:10px;">
<div class="muted">Click "Run" to generate suggestions</div>
</div>
</div>
</div>
</div>
</section>

<!-- Library Tab -->
<section id="library" class="tab-content">
<h2>Library</h2>
<div class="card" style="margin-top:12px;">
<div class="row" style="justify-content:space-between;">
<strong>Published Notes</strong>
<span class="muted">Browse your knowledge graph</span>
</div>
<ul id="libraryList" class="list" style="margin-top:10px;">
<li>Demo Note 1 - Market Analysis <span class="pill">published</span></li>
<li>Demo Note 2 - Fed Policy <span class="pill">published</span></li>
<li>Demo Note 3 - Tech Trends <span class="pill">published</span></li>
</ul>
</div>
</section>

<!-- Graph Tab -->
<section id="graph" class="tab-content">
<h2>Graph (Published Notes)</h2>
<p class="muted">Visual representation of your knowledge network</p>
<div class="card" style="margin:12px 0;">
<svg id="kg" viewBox="0 0 800 450" style="width:100%;height:420px;background:#f8fafc;">
<circle cx="200" cy="200" r="20" fill="#6366f1"/>
<circle cx="400" cy="150" r="20" fill="#6366f1"/>
<circle cx="600" cy="250" r="20" fill="#6366f1"/>
<line x1="200" y1="200" x2="400" y2="150" stroke="#cbd5e1"/>
<line x1="400" y1="150" x2="600" y2="250" stroke="#cbd5e1"/>
<text x="200" y="235" text-anchor="middle">Market Analysis</text>
<text x="400" y="135" text-anchor="middle">Fed Policy</text>
<text x="600" y="285" text-anchor="middle">Tech Trends</text>
</svg>
</div>
</section>

<!-- Forecasts Tab -->
<section id="forecasts" class="tab-content">
<h2>Forecasts</h2>
<div class="card" id="daily-forecasts" style="margin-top:12px;">
<h3>Today's Forecast Set</h3>
<div class="muted" style="margin-bottom:10px;">Live markets from Polymarket, Kalshi, and Prophet Arena. One vote per forecast.</div>
<div id="daily-list">
<!-- Demo forecast data hardcoded here -->
<div class="forecast-row">
<div class="forecast-source">polymarket</div>
<div class="forecast-title">Will the Federal Reserve cut interest rates by 0.5% or more at their next meeting?</div>
<div class="forecast-meta">p(yes) 34% ‚Ä¢ closes Dec 18, 2024</div>
<a href="https://polymarket.com/event/fed-rate-cut" target="_blank" class="forecast-link">open</a>
<div class="vote-box" data-forecast-id="fed-rate-cut-dec">
<label style="font-size:13px;color:#475569">Your p(yes):</label>
<input type="range" min="1" max="99" value="50" class="vote-slider" />
<output class="vote-output">50%</output>
<button class="btn primary vote-btn">Vote</button>
<span class="vote-msg muted"></span>
</div>
</div>

<div class="forecast-row">
<div class="forecast-source">kalshi</div>
<div class="forecast-title">Will November CPI inflation (YoY) be above 3.0%?</div>
<div class="forecast-meta">p(yes) 67% ‚Ä¢ closes Nov 13, 2024</div>
<a href="https://kalshi.com/markets/cpi-inflation-nov" target="_blank" class="forecast-link">open</a>
<div class="vote-box" data-forecast-id="cpi-inflation-nov">
<label style="font-size:13px;color:#475569">Your p(yes):</label>
<input type="range" min="1" max="99" value="50" class="vote-slider" />
<output class="vote-output">50%</output>
<button class="btn primary vote-btn">Vote</button>
<span class="vote-msg muted"></span>
</div>
</div>

<div class="forecast-row">
<div class="forecast-source">polymarket</div>
<div class="forecast-title">Will Bitcoin reach $100,000 before January 1, 2025?</div>
<div class="forecast-meta">p(yes) 23% ‚Ä¢ closes Dec 31, 2024</div>
<a href="https://polymarket.com/event/bitcoin-100k" target="_blank" class="forecast-link">open</a>
<div class="vote-box" data-forecast-id="bitcoin-100k">
<label style="font-size:13px;color:#475569">Your p(yes):</label>
<input type="range" min="1" max="99" value="50" class="vote-slider" />
<output class="vote-output">50%</output>
<button class="btn primary vote-btn">Vote</button>
<span class="vote-msg muted"></span>
</div>
</div>

<div class="forecast-row">
<div class="forecast-source">kalshi</div>
<div class="forecast-title">Will unemployment rate be below 4.0% in November 2024?</div>
<div class="forecast-meta">p(yes) 78% ‚Ä¢ closes Nov 8, 2024</div>
<a href="https://kalshi.com/markets/unemployment-nov" target="_blank" class="forecast-link">open</a>
<div class="vote-box" data-forecast-id="unemployment-nov">
<label style="font-size:13px;color:#475569">Your p(yes):</label>
<input type="range" min="1" max="99" value="50" class="vote-slider" />
<output class="vote-output">50%</output>
<button class="btn primary vote-btn">Vote</button>
<span class="vote-msg muted"></span>
</div>
</div>

<div class="forecast-row">
<div class="forecast-source">prophet-arena</div>
<div class="forecast-title">Will there be a major bank failure in the US before end of 2024?</div>
<div class="forecast-meta">p(yes) 12% ‚Ä¢ closes Dec 31, 2024</div>
<a href="https://prophetarena.co/event/bank-failure" target="_blank" class="forecast-link">open</a>
<div class="vote-box" data-forecast-id="bank-failure-2024">
<label style="font-size:13px;color:#475569">Your p(yes):</label>
<input type="range" min="1" max="99" value="50" class="vote-slider" />
<output class="vote-output">50%</output>
<button class="btn primary vote-btn">Vote</button>
<span class="vote-msg muted"></span>
</div>
</div>
</div>
</div>
</section>
</main>

<script>
// Supabase config (hardcoded as requested)
window.WILLOW_CFG = {
  url: 'https://dvfovhhjuutcdhxqtalm.supabase.co',
  anon: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR2Zm92aGhqdXV0Y2RoeHF0YWxtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0Nzk5NDMsImV4cCI6MjA3MTA1NTk0M30.tkAK1JAlKr2k6QAkudsUJdcHD9p3MHcLsJRjM-SJHvI'
};

// Tab management
function showTab(tabName) {
  // Hide all tabs
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.remove('active');
  });
  
  // Remove active from all nav chips
  document.querySelectorAll('nav .chip').forEach(chip => {
    chip.classList.remove('active');
  });
  
  // Show selected tab
  document.getElementById(tabName).classList.add('active');
  
  // Mark nav chip as active
  event.target.classList.add('active');
}

// Vote tracking (localStorage for demo)
const VOTE_STORAGE_KEY = 'willow_demo_votes';

function getVotes() {
  try {
    return JSON.parse(localStorage.getItem(VOTE_STORAGE_KEY) || '{}');
  } catch {
    return {};
  }
}

function saveVote(forecastId, probability) {
  const votes = getVotes();
  votes[forecastId] = probability;
  localStorage.setItem(VOTE_STORAGE_KEY, JSON.stringify(votes));
}

function hasVoted(forecastId) {
  return forecastId in getVotes();
}

// Initialize vote controls
function initVoteControls() {
  document.querySelectorAll('.vote-box').forEach(voteBox => {
    const forecastId = voteBox.dataset.forecastId;
    const slider = voteBox.querySelector('.vote-slider');
    const output = voteBox.querySelector('.vote-output');
    const button = voteBox.querySelector('.vote-btn');
    const message = voteBox.querySelector('.vote-msg');
    
    // Check if already voted
    if (hasVoted(forecastId)) {
      const votes = getVotes();
      const userVote = votes[forecastId];
      voteBox.innerHTML = `<span class="pill">Your vote: ${userVote}%</span> <span class="muted">(one vote per forecast)</span>`;
      return;
    }
    
    // Update output when slider changes
    slider.addEventListener('input', () => {
      output.textContent = slider.value + '%';
    });
    
    // Handle vote submission
    button.addEventListener('click', () => {
      const probability = parseInt(slider.value);
      
      button.disabled = true;
      message.textContent = 'Saving...';
      
      // Simulate network delay
      setTimeout(() => {
        saveVote(forecastId, probability);
        voteBox.innerHTML = `<span class="pill">Your vote: ${probability}%</span> <span class="muted">(one vote per forecast)</span>`;
      }, 500);
    });
  });
}

// Notes functionality (basic demo)
function runSuggestions() {
  const suggestionsDiv = document.getElementById('suggestions');
  suggestionsDiv.innerHTML = `
    <div style="padding:8px;border:1px solid var(--line);border-radius:8px;margin:4px 0;">
      <strong>Link to: Fed Policy</strong><br>
      <span class="muted">Related macroeconomic analysis</span><br>
      <button class="btn" style="margin-top:4px;padding:4px 8px;font-size:12px;">Add Link</button>
    </div>
    <div style="padding:8px;border:1px solid var(--line);border-radius:8px;margin:4px 0;">
      <strong>Link to: Market Analysis</strong><br>
      <span class="muted">Similar market dynamics</span><br>
      <button class="btn" style="margin-top:4px;padding:4px 8px;font-size:12px;">Add Link</button>
    </div>
  `;
}

// Initialize everything when page loads
document.addEventListener('DOMContentLoaded', () => {
  initVoteControls();
  
  // Basic note form handling
  document.getElementById('noteForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const msg = document.getElementById('saveMsg');
    msg.textContent = 'Note saved!';
    msg.className = 'muted ok';
    setTimeout(() => {
      msg.textContent = '';
      msg.className = 'muted';
    }, 2000);
  });
  
  document.getElementById('saveDraft').addEventListener('click', () => {
    const msg = document.getElementById('saveMsg');
    msg.textContent = 'Draft saved!';
    msg.className = 'muted ok';
    setTimeout(() => {
      msg.textContent = '';
      msg.className = 'muted';
    }, 2000);
  });
  
  document.getElementById('newNoteBtn').addEventListener('click', () => {
    showTab('notecard');
    document.querySelector('[name="title"]').focus();
  });
});

// Defensive measure: prevent any create/resolve forecast actions
['createForecast', 'saveForecast', 'resolveForecast', 'deleteForecast', 'editForecast', 'submitResolution'].forEach(fn => {
  window[fn] = () => {
    console.warn(`${fn} is disabled (read-only mode)`);
    alert('This site is read-only: creating or resolving forecasts is disabled.');
    return false;
  };
});

// Remove any stray create/resolve buttons that might appear
const observer = new MutationObserver(() => {
  document.querySelectorAll('[data-action="new-forecast"], [data-action="resolve-forecast"], .btn-new-forecast, .btn-resolve').forEach(el => {
    el.style.display = 'none';
    el.disabled = true;
  });
});
observer.observe(document.documentElement, { childList: true, subtree: true });
</script>
</body>
</html>
